{% extends "base.html" %}

{% block content %}

TELA EDITAR ORDEM DE COMPRA
<div class="container p-3 mb-3 border border-1 border-primary p-2 mb-2 div_principal">

    <form action="" method="POST">
        {{ form_editar_ordem_compra.csrf_token }}
        <div class="float-child0"> <!-- tela de pesquisa -->
            <div class="mb-3 float-child-tela-pesquisa">
                PESQUISA<BR>
                <div class="mb-3 float-child-tela-pesquisa border border-2 border-primary">
                    <div  class="col form-label  btn btn-light">
                        {{ form_editar_ordem_compra.data.label }}
                        {{ form_editar_ordem_compra.data(class="form-control", value=data) }}
                    </div>
                    <div  class="col form-label  btn btn-light">
                        {{ form_editar_ordem_compra.pesquisar_ordem_compra.label }}
                        {{ form_editar_ordem_compra.pesquisar_ordem_compra(class="form-control") }}
                    </div>
                    {{ form_editar_ordem_compra.botao_pesquisar_ordem_compra(class="btn btn-primary mt-5") }}
                    {{ form_editar_ordem_compra.botao_excluir_ordem_compra(class="btn btn-secondary mt-5", onclick="return confirm('Tem certeza de que deseja excluir esta ordem?')") }}

                </div>
                <div class="container_com_barra_rolagem_100%"> <!-- resultado da busca -->
                    <p>TELA RESULTADO</p>
                    <table class="table table-hover table-striped" style="position:sticky" cellpadding="2" cellspacing="2">
                    <thead>
                        <tr class="cab_tabela">
                            <th>DATA</th>
                            <th>ORDEM</th>
                            <th>DESCRIÇÃO</th>
                            <th>QUANTIDADE</th>
                            <th>VALOR UNITÁRIO</th>
                            <th>VALOR TOTAL</th>
                            <th>STATUS</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for i in ordem_pesquisada %}
                        <tr class="width:100%  height:100% table table-hover table-bordered table-striped table-sm table-layout:fixed">
                            <td>{{ i[0] }}</td>
                            <td>{{ i[1] }}</td>
                            <td>{{ i[3] }}</td>
                            <td>{{ i[8] }}</td>
                            <td>{{ i[9] }}</td>
                            <td>{{ i[10] }}</td>
                            <td></td>
                            <td>
                                <form method="POST">
                                    {{ form_editar_ordem_compra.hidden_tag() }}
                                    <input type="hidden" name="editar__item" value="{{ i[7] }}"><!-- value será chadado no arquivo main.py no acionamento do botao -->
                                     <button type="button" class="btn btn-primary" onclick="abrirModalEditar('{{ i[7] }}', '{{ i[3] }}', '{{ i[8] }}', '{{ i[9] }}')">Editar Item</button>

                                </form>
                            </td>
                            <td>
                                <form method="POST">
                                    {{ form_editar_ordem_compra.hidden_tag() }}
                                    <input type="hidden" name="excluir__item" value="{{ i[7] }}"><!-- value será chadado no arquivo main.py no acionamento do botao -->
                            {{ form_editar_ordem_compra.botao_excluir_item(class='btn btn-primary' , onclick="return confirm('Tem certeza de que deseja excluir esta ordem?')") }}
                                </form>
                            </td>
                        </tr>
                        {% endfor %}

                    </tbody>
                </table>
                    <div id="modalEditarItem" class="modal" style="display: none;">
                        <div class="modal-content">
                            <span class="close" onclick="fecharModalEditar()">&times;</span>
                            <h2>Editar Item</h2>
                            <form id="formEditarItem" method="POST" action="/editar_item">
                                {{ form_editar_ordem_compra.hidden_tag() }}
                                <label for="descricao">Descrição</label>
                                <input type="text" id="descricao" name="descricao" class="form-control" value="{{ descricao }}">
                                <label for="quantidade">Quantidade</label>
                                <input type="number" id="quantidade" name="quantidade" class="form-control" value="{{ quantidade }}">
                                <label for="valor_unitario">Valor Unitário</label>
                                <input type="number" id="valor_unitario" name="valor_unitario" step="0.01" class="form-control" value="{{ valor_unitario }}">
                                <input type="hidden" name="item_id" id="item_id" value="">
                                <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                            </form>
                        </div>
                    </div>


                    {{ form_editar_ordem_compra.botao_adicionar_item(class="btn btn-primary mt-5") }}
                    {{ form_editar_ordem_compra.botao_salvar_alteracoes(class="btn btn-primary mt-5") }}
                    {{ form_editar_ordem_compra.botao_descartar_alteracoes(class="btn btn-primary mt-5") }}
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}

function abrirModalEditar(itemId, descricao, quantidade, valorUnitario) {
    document.getElementById("item_id").value = itemId;
    document.getElementById("descricao").value = descricao;
    document.getElementById("quantidade").value = quantidade;
    document.getElementById("valor_unitario").value = valorUnitario;
    document.getElementById("modalEditarItem").style.display = "block";
}

function fecharModalEditar() {
    document.getElementById("modalEditarItem").style.display = "none";
}
