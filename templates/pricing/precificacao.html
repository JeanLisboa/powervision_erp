{% extends "base.html" %}

{% block content %}
TELA PRECIFICACAO
<style>
    .tabela_precificacao {
    border: none;               /* Remove a borda */
    outline: none;              /* Remove contorno ao focar */
    width: 80px;               /* Define largura fixa (100%) estava duplicado */
    padding: 0px;
    height: 20px;
    background-color: transparent; /* Fundo transparente */
}
</style>
<div class="container p-1 border border-1 border-primary p-2 mb-2 div_principal">

    <form action="" method="POST">
        {{ form_precificacao.csrf_token }}

    <div>
        <div class="col form-label btn btn-light">
            {{form_precificacao.data.label}}
            {{form_precificacao.data (class="form-control tam_campo_data value=data")}}
        </div>
        <div class="container p-3 mb-3 border border-primary div_principal">
            <div class="col form-label btn btn-light">
                {{form_precificacao.fornecedor.label}}
                {{form_precificacao.fornecedor (class="form-control tam_campo_data value=data")}}
            </div>
            <div class="col form-label btn btn-light">
                {{form_precificacao.ean.label}}
                {{form_precificacao.ean (class="form-control tam_campo_data value=data")}}
            </div>
            <div class="col form-label btn btn-light">
                {{form_precificacao.descricao.label}}
                {{form_precificacao.descricao (class="form-control tam_campo_data value=data")}}
            </div>
            <div class="col form-label btn btn-light">
                {{form_precificacao.unidade.label}}
                {{form_precificacao.unidade (class="form-control tam_campo_data value=data")}}
            </div>

            <div class="col form-label btn btn-light">
                {{form_precificacao.botao_pesquisar (class="btn btn-primary mt-4")}}
            </div>
            <div class="col form-label btn btn-light">
                {{form_precificacao.botao_calcular (class="btn btn-primary mt-4")}}
            </div>
            <div class="col form-label btn btn-light">
                {{ form_precificacao.botao_salvar(class="btn btn-primary mt-4") }}
            </div>
            <div class="col form-label btn btn-light">
                {{ form_precificacao.botao_cancelar(class="btn btn-primary mt-4") }}
            </div>

        </div>
        <div  class="borda_simples  container_com_barra_rolagem">
                <table class="table table-hover table-striped tabela_precificacao" style="position:sticky top: 0" cellpadding="0" cellspacing="0" id="">
                    <thead>
                        <tr>
                            <th>Descri√ß√£o</th>
                            <th>EAN</th>
                            <th>UN</th>
                            <th>VALOR</th>
                            <th>MARGEM</th>
                            <th>CUSTO TOTAL</th>
                            <th>MARKUP</th>
                            <th>ACRESCIMO</th>
                            <th>DESCONTO</th>
                            <th>PRE√áO FINAL</th>
                        </tr>
                    </thead>
                <tbody>
                {% if relatorio_precificacao %}
                    {% for i in relatorio_precificacao %}
                        <tr class=" width:100%  height:100% table table-hover table-bordered table-striped table-sm table-layout:fixed ">
                            <td>{{i[4]}}</td>
                            <td>{{i[3]}}</td>
                            <td>{{i[5]}}</td>
                            <td>{{i[7]}}</td>
                            <td><input class="form-control tabela_precificacao" type="number" name="margem_{{ loop.index0 }}" step="0.01" /></td>
                            <td><input class="form-control tabela_precificacao" type="number" name="custo_total_{{ loop.index0 }}" step="0.01" /></td>
                            <td><input class="form-control tabela_precificacao"  type="number" name="markup_{{ loop.index0 }}" step="0.01" /></td>
                            <td><input class="form-control tabela_precificacao"  type="number" name="acrescimo_{{ loop.index0 }}" step="0.01" /></td>
                            <td><input class="form-control tabela_precificacao"  type="number" name="desconto_{{ loop.index0 }}" step="0.01" /></td>
                            <td></td>
                        </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="10">Nenhuma informa√ß√£o encontrada</td>
                    </tr>
                {% endif %}
            </tbody>
            </table>

        <div class="container p-3 mb-3 border border-primary div_principal">
            <div class="col form-label btn btn-light">
                {{form_precificacao.margem_lucro.label}}
               {{ form_precificacao.margem_lucro(class="form-control tam_campo_data comentario='Precifica√ß√£o'") }}
            </div>
            <div class="col form-label btn btn-light">
                {{form_precificacao.custo_total.label}}
                {{form_precificacao.custo_total (class="form-control tam_campo_data, value=data")}}
            </div>
            <div class="col form-label btn btn-light">
                {{form_precificacao.preco_final.label}}
                {{form_precificacao.preco_final (class="form-control tam_campo_data, value=data")}}
            </div>
            <div class="col form-label btn btn-light">
                {{form_precificacao.markup.label}}
                {{form_precificacao.markup (class="form-control tam_campo_data, value=data")}}
            </div>
            <div class="col form-label btn btn-light">
                {{form_precificacao.desconto.label}}
                {{form_precificacao.desconto (class="form-control tam_campo_data, value=data")}}
            </div>
            </div>
            <div class="col form-label btn btn-light">
                {{form_precificacao.acrescimo.label}}
                {{form_precificacao.acrescimo (class="form-control tam_campo_data, value=data")}}
            </div>
        </div>
    </div>

        <pre>
      üõ†Ô∏è Fluxo sugerido:
üîπ Etapa 1: Cadastro da Ordem de Compra
Fornecedor, EAN, descri√ß√£o, custo de aquisi√ß√£o (valor), etc.

üîπ Etapa 2: Precifica√ß√£o e an√°lise estrat√©gica
Este √© o momento ideal para tratar:

Item	                A√ß√£o
Margem de lucro	        |Aplicar sobre o custo (ex: markup ou margem l√≠quida desejada)
Pre√ßo de concorr√™ncia	|Consultar pre√ßos do mercado e definir um teto ou piso
Valor percebido	Avaliar |o quanto o cliente est√° disposto a pagar (ver mais abaixo)
Custos fixos/vari√°veis	|Distribuir os custos por unidade (rateio, absor√ß√£o)
Pre√ßo sugerido final	|Gerado automaticamente, podendo ser ajustado manualmente

üß© Como considerar o valor percebido pelo cliente?
üí° Valor percebido ‚â† valor de aquisi√ß√£o ou de concorr√™ncia.
√â o benef√≠cio percebido em rela√ß√£o ao pre√ßo. Pode ser comparado com:

Benchmark de produtos similares (concorrentes diretos).
Feedback de clientes (ex: pesquisas ou hist√≥rico de vendas).
Elasticidade de pre√ßo hist√≥rica (como a venda reage a mudan√ßas de pre√ßo).

Exemplo de compara√ß√£o:

preco_sugerido = custo + margem + rateio_custos
* rateio_custos sao custos fixos ou vari√°veis que devem ser dividos pela quantidade vendida

if preco_sugerido > valor_percebido:
    # Talvez o cliente n√£o veja valor suficiente; reduzir margem ou reestruturar produto
üîÅ Estrat√©gia recomendada para ERP:
Crie um m√≥dulo de precifica√ß√£o que ser√° alimentado:

Ap√≥s o cadastro de produto pela ordem de compra.

E que calcule:

Custo total (custo + custos rateados)
Margem ideal vs. margem m√≠nima

Compara√ß√£o com concorr√™ncia

Valor percebido (entrada manual ou predefinido por linha/produto)

E gere o pre√ßo final sugerido.

=============================
custo_total = custo_compra + rateio_custos
preco_final = custo_total * markup

            üìà O que √© markup?
Markup √© um fator multiplicador aplicado sobre o custo total de um produto para formar o pre√ßo de venda com lucro embutido e, se necess√°rio, impostos e despesas fixas.

üìå Resumo:
Pre√ßo de Venda = Custo √ó Markup

üßÆ Como calcular o markup?
Existem duas formas principais:

‚úÖ 1. Markup sobre o custo (mais comum em ERP)
Markup = Pre√ßo de Venda / Custo
Exemplo:

Custo do produto: R$ 50

Pre√ßo de venda: R$ 80

‚û°Ô∏è Markup = 80 / 50 = 1,60

Isso quer dizer que o pre√ßo √© 60% maior que o custo.

‚úÖ 2. Markup desejado para atingir uma margem
Quando voc√™ quer uma margem de lucro, usa esta f√≥rmula:

Markup = 1 / (1 - Margem)
Se quiser uma margem de 30%:

Markup = 1 / (1 - 0,30) = 1,4286

Aplicando ao custo de R$ 50:
Pre√ßo de venda = 50 √ó 1,4286 = R$ 71,43

üß† Diferen√ßa entre markup e margem?
Conceito	Defini√ß√£o
Markup	Multiplicador sobre o custo
Margem	Percentual de lucro sobre o pre√ßo de venda

Exemplo com custo R$ 50 e venda R$ 80:

Markup = 80 / 50 = 1,6

Margem = (80 - 50) / 80 = 37,5%

üìå Em um sistema ERP:
Voc√™ pode usar markup para precificar automaticamente com base em regras de produto, categoria ou fornecedor.

        </pre>

{% endblock %}