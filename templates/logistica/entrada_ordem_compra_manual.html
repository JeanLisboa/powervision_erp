{% extends "base.html" %}


{% block content %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <title>{% block title %}Mod Logistica | Entrada Por ordem_compra{% endblock %}</title>
<h5>Entrada por ordem_compra</h5>
<div class="page">
    <form action="" method="POST">
        {{ form_entrada_ordem_compra_manual.csrf_token }}
        <!-- Filtros -->
        <section class="top-left">
            <div class="col form-label btn btn-light">
                {{ form_entrada_ordem_compra_manual.data.label }}
                {{ form_entrada_ordem_compra_manual.data(class="form-control tam_campo_data", value=data) }}
            </div>
            <div class="col form-label btn btn-light">
                {{ form_entrada_ordem_compra_manual.ordem_compra.label }}
                {{ form_entrada_ordem_compra_manual.ordem_compra(class="form-control tam_campo_data", value=nf) }}
            </div>
            {{ form_entrada_ordem_compra_manual.botao_pesquisar_ordem_compra(class="btn btn-primary") }}
           {{ form_entrada_ordem_compra_manual.botao_salvar_entrada(
                class="btn btn-primary",
                id="botao_salvar_entrada"

) }}

        </section>
        <!-- Tabela 2 (resultado da consulta) -->
        <section class="box top-right">
            <div style="max-height: 320px; overflow-y: auto; overflow-x: auto;">
                <table class="table table-hover table-striped table-bordered tabela-padrao">
                    <thead>
                        <tr>
                            <th style="width: 10%;">Data Ordem</th>
                            <th>Ordem</th>
                            <th>Item</th>
                            <th>Descrição</th>
                            <th>UN</th>
                            <th>Categoria</th>
                            <th>Codigo</th>
                            <th>EAN</th>
                            <th>Qtde</th>
                            <th>Valor Un</th>
                            <th>Valor Total</th>
                            <th>Qtde Pend</th>
                            <th>Valor Pend</th>
                            <th>Status</th>
                            <th>Usuario</th>
                            <th>Entrada Quant.</th>
                            <th>Entrada Valor</th>


                        </tr>
                    </thead>
                    <tbody>
                        {% if resultado_pesquisa %}
                            {% for i in resultado_pesquisa %}
                                <tr>
                                        <td>{{ i[0] }}</td> <!-- data -->
                                        <td>{{ i[1] }}</td> <!-- ordem -->
                                        <td>{{ i[2] }}</td> <!-- item -->
                                        <td>{{ i[3] }}</td> <!-- descricao -->
                                        <td>{{ i[4] }}</td> <!-- un -->
                                        <td>{{ i[5] }}</td> <!-- categoria -->
                                        <td>{{ i[6] }}</td> <!-- codigo -->
                                        <td>{{ i[7] }}</td> <!-- EAN -->
                                        <td>{{ i[8] }}</td> <!-- Qtd -->
                                        <td>{{ i[9] }}</td> <!-- Val un -->
                                        <td>{{ i[10] }}</td> <!-- Valor Total -->
                                        <td>{{ i[11] }}</td> <!-- Qtde Pendente -->
                                        <td>{{ i[12] }}</td> <!-- Valor Pendente -->
                                        <td>{{ i[13] }}</td> <!-- Status Ordem -->
                                        <td>{{ i[14] }}</td> <!-- User -->
                                        <td>
                                            <label>
                                                <input class="form-control entrada_ordem_compra_manual altura_input_padrao"
                                                   type="number"
                                                   name="campo_entrada_quantidade{{ loop.index0 }}"
                                                   value="{{ i[11] if i[11] is not none or i[11] != '' else 0.00 }}"
                                                   min="0.00"
                                                   max="{{ i[11] }}"
                                                   step="1" />
                                            </label>
                                        </td>
                                        <td>
                                            <label>
                                                <input class="form-control entrada_ordem_compra_manual"
                                                       type="number"
                                                       name="campo_entrada_valor{{ loop.index0 }}"
                                                       value="{{ i[10] if i[10] is not none or i[10] != '' else 0.00 }}"
                                                       min="0.00"
                                                       max="{{ i[10] }}"
                                                       step="0.01" />
                                            </label>
                                        </td>
                                        <td>
                                            <a href="#" id="linkLotes" class="text-primary fw-bold" style="cursor:pointer;">
    Gerenciar lotes
</a>
                                        </td>
                                </tr>
                            {% endfor %}
                            {% else %}
                            <tr>
                                <td colspan="17">Nenhuma informação encontrada</td>
                            </tr>
                        {% endif %}

                    </tbody>

                </table>
            </div>
        </section>
    </form>

   <!-- Link para mostrar/ocultar seção de lotes -->

<br>
<!-- Seção de lotes (inicialmente escondida) -->
<div id="secaoLotes" class="mt-3 d-none">

    <table class="table table-bordered align-middle">
        <thead class="table-light">
            <tr>
                <th>Lote</th>
                <th>Validade</th>
                <th>Quantidade</th>
               <th>Obs</th>
                <th>Ações</th>
            </tr>
        </thead>

        <tbody id="listaLotes">
            <!-- Linha de exemplo -->
            <tr>
                <td>L001</td>
                <td>2025-10-01</td>
                <td>20</td>
                <td>—</td>
                <td>
                    <button class="btn btn-warning btn-sm">Editar</button>
                    <button class="btn btn-danger btn-sm">Excluir</button>
                </td>
           </tr>
        </tbody>
    </table>

    <button class="btn btn-success btn-sm" id="addLoteBtn">+ Adicionar Lote</button>

    <!-- Form de adicionar/editar lote -->
    <div id="formLote" class="mt-3 d-none">
        <div class="card p-3">
            <div class="row g-3">

                <div class="col-md-3">
                    <label class="form-label">Lote</label>
                    <input type="text" class="form-control" id="campoLote">
                </div>

                <div class="col-md-3">
                    <label class="form-label">Validade</label>
                    <input type="date" class="form-control" id="campoValidade">
                </div>

                <div class="col-md-3">
                    <label class="form-label">Quantidade</label>
                    <input type="number" class="form-control" id="campoQuantidade">
                </div>

                <div class="col-md-3">
                    <label class="form-label">Observação</label>
                    <input type="text" class="form-control" id="campoObs">
                </div>

            </div>

            <div class="mt-3 text-end">
                <button class="btn btn-secondary" id="cancelarLoteBtn">Cancelar</button>
                <button class="btn btn-primary">Salvar Lote</button>
            </div>
        </div>
    </div>

</div>

<script>
    const linkLotes = document.getElementById("linkLotes");
    const secaoLotes = document.getElementById("secaoLotes");

    linkLotes.addEventListener("click", function(e) {
        e.preventDefault();
        secaoLotes.classList.toggle("d-none");
    });

    const addLoteBtn = document.getElementById("addLoteBtn");
    const formLote = document.getElementById("formLote");
    const cancelarLoteBtn = document.getElementById("cancelarLoteBtn");

    addLoteBtn.addEventListener("click", () => {
        formLote.classList.remove("d-none");
    });

    cancelarLoteBtn.addEventListener("click", () => {
        formLote.classList.add("d-none");
    });
</script>

    ----------------------------------------

    ----------------------------------------
</div>


{% endblock %}
