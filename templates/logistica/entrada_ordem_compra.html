{% extends "base.html" %}
{% block content %}
TELA ENTRADA ORDEM DE COMPRA

<div class="container p-3 mb-3 border border-1 border-primary  div_principal">

  <form action="" method="POST"> {{ form_entrada_ordem_compra.csrf_token }}
    <pre>
      - NF TESTE: 2112 E 2299
      1 -  APOS A CONFIRM DA ENTRADA DOS PEDIDOS:
        1.1 - ATUALIZAR ESTOQUE
        1.2 - ATUALIZAR ORDEM DE COMPRA
      2 - CORRIGIR TELA PARA NAO LIMPAR OS CAMPOS APÓS CLICAR EM ANALISAR CONFERENCIA
      3 - O BOTAO ANALISAR CONFERENCIA SÓ DEVE APARECER APÓS CLICAR EM REALIZAR CONFERENCIA
      *** - O PROCESSO DE ENTRADA DE ORDEM COMPRA DEVE SER FINALIZADO COM A ATUALIZAÇÃO DO ESTOQUE E DO STATUS DA ORDEM DE COMPRA
      *** - DEVEM SER RESPEITADOS OS CRITÉRIOS PARA RECEBIMENTO.
        - SE ACEITA PARCIAL
        - SE GERA SALDO DE PEDIDO.
   </pre>

  <div class="mb-3 float-child-tela-pesquisa"> <!-- DIV 1 SUPERIOR (ESQUERDA) -->
    <div class="col form-label btn btn-light">
      {{ form_entrada_ordem_compra.data.label }}
      {{ form_entrada_ordem_compra.data(class="form-control tam_campo_data", value=data) }}
    </div>
    <div class="col form-label btn btn-light">
      {{ form_entrada_ordem_compra.nf.label }}
      {{ form_entrada_ordem_compra.nf(class="form-control tam_campo_data", value=ordem_compra) }}
    </div>
    <div class="col form-label btn btn-light">
      {{ form_entrada_ordem_compra.botao_pesquisar_ordem_compra(class="btn btn-primary mt-4") }}
    </div>
  </div> <!--  FIM DA DIV 1 SUPERIOR -->
  <div class=" mb-3 float-child-tela-pesquisa"> <!-- DIV 2 SUPERIOR (DIREITA) -->
    <table class="table table-striped mt-0" style="position:sticky" cellpadding="2" cellspacing="2">
      <thead>
        <tr class="cab_tabela">
          <th>CNPJ</th>
          <th>RAZAO SOCIAL REMETENTE</th>
          <th>NF</th>
          <th>ORDEM</th>
          <th>STATUS</th>
        </tr>
      </thead>
      <tbody>
        <tr class="width:100%  height:100% table table-hover table-bordered table-striped table-sm table-layout:fixed">
          <td>{{ lst_nf[0] }}</td>
          <td>{{ lst_nf[1] }}</td>
          <td>{{ lst_nf[2] }}</td>
          <td>{{ lst_nf[3] }}</td>
          <td>{{ lst_nf[4] }}</td>
        </tr>
      </tbody>
    </table>
      {{ form_entrada_ordem_compra.botao_realizar_conferencia (class="btn btn-primary mt-0") }}
      {{ form_entrada_ordem_compra.botao_limpar_pesquisa (class="btn btn-secondary mt-0") }}
  </div> <!-- FIM DA DIV 2 SUPERIOR -->


          <div> <!-- DIV 1 INFERIOR (TABELA DA ESQUERDA) -->
            <table class="table table-hover table-striped float-tela-conferencia-esquerda" style="position:sticky" cellpadding="2" cellspacing="2" >
              <thead>
                <tr class="cab_tabela">
                  <th class="tam_campo_codigo">EAN</th>
                  <th class="tam_campo_descricao_tabela">DESCRICAO</th>
                  <th class="tam_coluna_quantidade">QUANTIDADE</th>
                </tr>
              </thead>
              <tbody>
                {% for i in itens_conferencia %}
                <tr class="width: 50%  height:50% table table-hover table-bordered table-striped table-sm table-layout:fixed ">
                  <td>{{ i[7] }}</td>
                  <td>{{ i[3] }}</td>
                  <td>{{ form_entrada_ordem_compra.quantidade(class="form-control tam_campo_data background-color-input")  }}</td>

                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div> <!-- FIM DO DIV 1 INFERIOR -->

          <div> <!-- DIV 2  INFERIOR (TABELA DA DIREITA)-->
            <table class="table table-hover table-striped float-tela-conferencia-direita" style="position:sticky" cellpadding="2" cellspacing="2" >
              <thead>
                <tr class="cab_tabela">
                   <th class="tam_campo_codigo">DIFERENÇA</th>
                  <th class="tam_campo_descricao_tabela">STATUS</th>
                </tr>
              </thead>
              <tbody>
                {% for i in lst_diferenca %}
                <tr>
                  <td style="height: 48px;">{{ i[0] }}</td>
                  <td style="height: 48px;">{{ i[1] }}</td>

                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div> <!-- div 3 -->
          <div>
            {{ form_entrada_ordem_compra.botao_analisar_conferencia (class="btn btn-primary mt-0") }}
          </div>
  </form>
</div>
{% endblock %}

<script>
    // Armazena os valores antes do envio do formulário
    document.getElementById('botao_analisar_conferencia').addEventListener('click', function() {
        {% for i in itens_conferencia %}
        let quantidade{{ loop.index0 }} = document.getElementById('quantidade_{{ loop.index0 }}').value;
        localStorage.setItem('quantidade_{{ loop.index0 }}', quantidade{{ loop.index0 }});
        {% endfor %}
    });

    window.onload = function() {
    {% for i in itens_conferencia %}
        {% for a in lst_qtde_pedido %}
            let quantidadeId = 'quantidade_{{ forloop.parentloop.index0 }}_{{ forloop.index0 }}';
            let quantidadeValue = localStorage.getItem(quantidadeId);
            if (quantidadeValue !== null) {
                document.getElementById(quantidadeId).value = quantidadeValue;
            }
        {% endfor %}
    {% endfor %}
};
</script>
